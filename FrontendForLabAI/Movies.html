<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Movie Assistant & Recommendations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            color: #b8b8b8;
            font-size: 1.2rem;
        }

        .section {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            color: #feca57;
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid #feca57;
            padding-bottom: 10px;
        }

        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #feca57;
            font-weight: 600;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(254, 202, 87, 0.3);
        }

        button {
            padding: 12px 30px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-end;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Deep Think */
        .deep-think-btn {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            color: white;
        }

        .deep-think-btn:hover {
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }

        .deep-think-btn.active {
            background: linear-gradient(45deg, #2575fc, #6a11cb);
            box-shadow: 0 0 20px rgba(37, 117, 252, 0.5);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Clear History */
        .clear-history-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
        }

        .clear-history-btn:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .clear-history-btn:disabled {
            background: linear-gradient(45deg, #666, #888);
            color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .movie-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeIn 0.5s ease;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.12);
        }

        .chat-message {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            border-left-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
        }

        .assistant-message {
            border-left-color: #feca57;
            background: rgba(254, 202, 87, 0.1);
        }

        .deep-think-message {
            border-left-color: #6a11cb;
            background: rgba(106, 17, 203, 0.1);
            border: 1px solid rgba(106, 17, 203, 0.3);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .movie-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .movie-title {
            font-size: 2rem;
            color: #feca57;
            margin-bottom: 10px;
        }

        .movie-overview {
            color: #b8b8b8;
            font-size: 1.1rem;
            line-height: 1.5;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4ecdc4;
        }

        .movie-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #feca57;
        }

        .detail-label {
            font-size: 0.9rem;
            color: #b8b8b8;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 1.1rem;
            color: #fff;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #feca57;
        }

        .error {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .warning {
            background: rgba(254, 202, 87, 0.2);
            border: 1px solid #feca57;
            color: #feca57;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .hidden {
            display: none;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .recommendation-title {
            font-size: 1.2rem;
            color: #feca57;
            margin: 0;
        }

        .recommendation-overview {
            color: #b8b8b8;
            font-size: 0.95rem;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .recommendation-details {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: #b8b8b8;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: #b8b8b8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: #1a1a2e;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .model-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .chat-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
        }

        .conversation-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .conversation-id {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #b8b8b8;
        }

        .deep-think-indicator {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: white;
            font-weight: 600;
        }

        .similarity-score {
            background: rgba(78, 205, 196, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #4ecdc4;
        }

        .clarification-questions {
            background: rgba(254, 202, 87, 0.1);
            border: 1px solid #feca57;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .question-item {
            margin: 8px 0;
            color: #feca57;
        }

        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }

            .model-options {
                grid-template-columns: 1fr;
            }

            button {
                align-self: stretch;
            }

            .movie-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            h1 {
                font-size: 2rem;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .chat-input-container {
                flex-direction: column;
            }

            .tab-buttons {
                flex-direction: column;
            }

            .conversation-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üé¨ AI Movie Assistant</h1>
            <p class="subtitle">Chat with AI to get personalized movie recommendations</p>
        </header>

        <!-- AI Assistant Chat Section -->
        <section class="section">
            <h2 class="section-title">ü§ñ AI Movie Assistant</h2>

            <div class="conversation-controls">
                <button type="button" onclick="startNewConversation()">üîÑ New Conversation</button>
                <button type="button" id="deepThinkBtn" class="deep-think-btn" onclick="toggleDeepThink()">
                    üß† Deep Think: OFF
                </button>
                <button type="button" id="clearHistoryBtn" class="clear-history-btn" onclick="clearMessageHistory()">
                    üóëÔ∏è Clear Message History
                </button>
                <div class="conversation-id" id="conversationId">Starting new conversation...</div>
            </div>

            <div class="chat-container" id="chatContainer">
                <div class="chat-message assistant-message">
                    <strong>ü§ñ Assistant:</strong> Hello! I'm your movie recommendation assistant. Tell me what kind of
                    movies you like, and I'll help you find something great to watch! You can mention genres, moods,
                    favorite films, or anything else that comes to mind.<br><br>
                    <strong>üí° Pro Tip:</strong> Use the <em>"Deep Think"</em> mode for more detailed analysis and better recommendations!
                </div>
            </div>

            <div class="chat-input-container">
                <div class="input-group chat-input">
                    <label for="userMessage">Your Message:</label>
                    <textarea id="userMessage"
                        placeholder="Tell me about your movie preferences... (e.g., 'I like sci-fi movies with good action and interesting stories')"
                        rows="3"></textarea>
                </div>
                <button type="button" onclick="sendMessage()">Send</button>
            </div>
        </section>

        <!-- Traditional Search Section -->
        <section class="section">
            <h2 class="section-title">üîç Traditional Search</h2>
            <div class="search-form">
                <div class="input-group">
                    <label for="movieId">Search by Movie ID:</label>
                    <input type="number" id="movieId" placeholder="Enter movie ID (e.g., 10)" min="1" value="10">
                </div>
                <div class="input-group">
                    <label for="movieTitle">Search by Title:</label>
                    <input type="text" id="movieTitle" placeholder="Enter movie title">
                </div>
                <button type="button" onclick="searchMovie()">Search Movie</button>
            </div>
        </section>

        <!-- Recommendations Section -->
        <section class="section">
            <h2 class="section-title">üéØ Direct Recommendations</h2>

            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('byDescription')">By Description</button>
                <button class="tab-button" onclick="switchTab('byMovieTitle')">By Movie Title</button>
            </div>

            <div class="model-options">
                <div class="input-group">
                    <label for="embeddingModel">AI Model:</label>
                    <select id="embeddingModel">
                        <option value="nomic-embed-text">nomic-embed-text</option>
                        <option value="all-minilm">all-minilm</option>
                        <option value="bge-m3">bge-m3</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="distanceMetric">Distance Metric:</label>
                    <select id="distanceMetric">
                        <option value="cosine">Cosine Similarity</option>
                        <option value="euclidean">Euclidean Distance</option>
                        <option value="manhattan">Manhattan Distance</option>
                        <option value="dot">Dot Product</option>
                    </select>
                </div>
            </div>

            <!-- By Description Tab -->
            <div id="byDescription" class="tab-content active">
                <div class="search-form">
                    <div class="input-group">
                        <label for="description">Movie Description:</label>
                        <input type="text" id="description" placeholder="Describe what you want to watch...">
                    </div>
                    <div class="input-group">
                        <label for="topK">Number of Results:</label>
                        <select id="topK">
                            <option value="5">5 movies</option>
                            <option value="10" selected>10 movies</option>
                            <option value="15">15 movies</option>
                        </select>
                    </div>
                    <button type="button" onclick="getRecommendationsByDescription()">Get Recommendations</button>
                </div>
            </div>

            <!-- By Movie Title Tab -->
            <div id="byMovieTitle" class="tab-content">
                <div class="search-form">
                    <div class="input-group">
                        <label for="recommendationMovieTitle">Movie Title:</label>
                        <input type="text" id="recommendationMovieTitle" placeholder="Enter a movie title...">
                    </div>
                    <div class="input-group">
                        <label for="topKTitle">Number of Results:</label>
                        <select id="topKTitle">
                            <option value="5">5 movies</option>
                            <option value="10" selected>10 movies</option>
                            <option value="15">15 movies</option>
                        </select>
                    </div>
                    <button type="button" onclick="getRecommendationsByTitle()">Find Similar Movies</button>
                </div>
            </div>
        </section>

        <!-- Loading and Error Sections -->
        <div id="loading" class="loading hidden">
            <p>ü§î Thinking...</p>
        </div>

        <div id="error" class="error hidden">
            <p id="errorMessage"></p>
        </div>

        <!-- Movie Results -->
        <div id="movieResult" class="hidden">
            <!-- Movie card will be inserted here -->
        </div>

        <div id="noResults" class="error hidden">
            <p>No movie found. Please check the ID or title and try again.</p>
        </div>

        <!-- Recommendations Results -->
        <div id="recommendationsResult" class="hidden">
            <h2 class="section-title">üéØ Recommendations</h2>
            <div id="recommendationsList"></div>
        </div>

        <!-- Debug Info -->
        <div id="debugInfo" class="section hidden" style="background: rgba(255,255,255,0.05);">
            <h3 class="section-title">üêõ Debug Information</h3>
            <pre id="debugContent" style="color: #b8b8b8; font-family: monospace; white-space: pre-wrap;"></pre>
        </div>
    </div>

    <script>
        const API_BASE_URLS = [
            'http://localhost:8080/api',
            'https://localhost:44372/api'
        ];

        let currentApiBase = API_BASE_URLS[1];
        let currentConversationId = null;
        let useDeepThink = false;
		
		    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –±–µ—Å–µ–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    async function createNewConversation() {
        try {
            const response = await fetch(`${currentApiBase}/assistant/conversation/new`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

            const result = await response.json();
            currentConversationId = result.conversationId;
            document.getElementById('conversationId').textContent = `Conversation: ${currentConversationId}`;
            
        } catch (error) {
            console.error('Error creating conversation:', error);
            document.getElementById('conversationId').textContent = 'No conversation (using default)';
        }
    }

        // Deep Think toggle function
        function toggleDeepThink() {
            useDeepThink = !useDeepThink;
            const deepThinkBtn = document.getElementById('deepThinkBtn');
            
            if (useDeepThink) {
                deepThinkBtn.innerHTML = 'üß† Deep Think: ON';
                deepThinkBtn.classList.add('active');
            } else {
                deepThinkBtn.innerHTML = 'üß† Deep Think: OFF';
                deepThinkBtn.classList.remove('active');
            }
            
            debugLog(`Deep Think mode: ${useDeepThink ? 'ON' : 'OFF'}`);
        }

        // Clear Message History function - —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç API endpoint
        async function clearMessageHistory() {
            if (!currentConversationId) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –±–µ—Å–µ–¥—ã, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                clearChatInterface();
                return;
            }

            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const originalText = clearHistoryBtn.innerHTML;
            
            try {
                // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
                clearHistoryBtn.disabled = true;
                clearHistoryBtn.innerHTML = 'üóëÔ∏è Deleting...';

                debugLog(`Deleting conversation: ${currentConversationId}`);

                const response = await fetch(`${currentApiBase}/assistant/conversation/${currentConversationId}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        debugLog('Conversation not found on server, clearing local history only');
                        clearChatInterface();
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                debugLog('Conversation deleted successfully:', result);

                // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
                clearChatInterface();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                addMessageToChat('assistant', 'Conversation history has been successfully deleted. Starting a fresh conversation!');

            } catch (error) {
                console.error('Error deleting conversation:', error);
                debugLog('Error deleting conversation:', error.message);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                addMessageToChat('assistant', 'Sorry, I encountered an error while trying to delete the conversation history. The local chat has been cleared.');
                
                // –í—Å–µ —Ä–∞–≤–Ω–æ –æ—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                clearChatInterface();
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                clearHistoryBtn.disabled = false;
                clearHistoryBtn.innerHTML = originalText;
				createNewConversation()
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–∞—Ç–∞
        function clearChatInterface() {
            const chatContainer = document.getElementById('chatContainer');
            
            // –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
            chatContainer.innerHTML = `
                <div class="chat-message assistant-message">
                    <strong>ü§ñ Assistant:</strong> Hello! I'm your movie recommendation assistant. Tell me what kind of movies you like, and I'll help you find something great to watch! You can mention genres, moods, favorite films, or anything else that comes to mind.<br><br>
                    <strong>üí° Pro Tip:</strong> Use the <em>"Deep Think"</em> mode for more detailed analysis and better recommendations!
                </div>
            `;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º ID –±–µ—Å–µ–¥—ã
            currentConversationId = null;
            document.getElementById('conversationId').textContent = 'Starting new conversation...';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º Deep Think
            useDeepThink = false;
            document.getElementById('deepThinkBtn').innerHTML = 'üß† Deep Think: OFF';
            document.getElementById('deepThinkBtn').classList.remove('active');
            
            debugLog('Chat interface cleared');
        }

        // Chat functionality
        async function sendMessage() {
            const userMessage = document.getElementById('userMessage').value.trim();
            if (!userMessage) return;

            hideAllSections();
            showLoading();
            addMessageToChat('user', userMessage);
            document.getElementById('userMessage').value = '';

            try {
                const response = await fetch(`${currentApiBase}/assistant/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        Message: userMessage,
                        ConversationId: currentConversationId,
                        ResetConversation: false,
                        UseDeepThink: useDeepThink
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const assistantResponse = await response.json();
                currentConversationId = assistantResponse.conversationId;

                // Update conversation ID display
                document.getElementById('conversationId').textContent = `Conversation: ${currentConversationId}`;

                // Add assistant response to chat
                addMessageToChat('assistant', assistantResponse.response, assistantResponse);

            } catch (error) {
                console.error('Chat error:', error);
                addMessageToChat('assistant', 'Sorry, I encountered an error. Please try again.');
            } finally {
                hideLoading();
            }
        }

        function addMessageToChat(role, content, assistantResponse = null) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
            let messageClass = `chat-message ${role}-message`;
            if (assistantResponse && assistantResponse.usedDeepThink) {
                messageClass = 'chat-message deep-think-message';
            }
            
            messageDiv.className = messageClass;

            let messageContent = `<strong>${role === 'user' ? 'üë§ You' : 'ü§ñ Assistant'}:</strong>`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä Deep Think –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
            if (assistantResponse && assistantResponse.usedDeepThink) {
                messageContent += ` <span style="color: #6a11cb; font-weight: 600;">üß† [Deep Think Analysis]</span>`;
            }
            
            messageContent += ` ${escapeHtml(content)}`;

            // Add recommendations if available
            if (assistantResponse && assistantResponse.recommendedMovies && assistantResponse.recommendedMovies.length > 0) {
                messageContent += `<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">`;
                messageContent += `<strong>üé¨ Recommended Movies:</strong><br>`;
                assistantResponse.recommendedMovies.forEach(movie => {
                    messageContent += `‚Ä¢ <em>${escapeHtml(movie.title)}</em><br>`;
                });
                messageContent += `</div>`;
            }

            // Add clarification questions if needed
            if (assistantResponse && assistantResponse.needsClarification && assistantResponse.clarificationQuestions.length > 0) {
                messageContent += `<div class="clarification-questions" style="margin-top: 15px;">`;
                messageContent += `<strong>üí° To help me better:</strong><br>`;
                assistantResponse.clarificationQuestions.forEach(question => {
                    messageContent += `<div class="question-item">${escapeHtml(question)}</div>`;
                });
                messageContent += `</div>`;
            }

            messageDiv.innerHTML = messageContent;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function startNewConversation() {
            currentConversationId = null;
            useDeepThink = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º Deep Think –ø—Ä–∏ –Ω–æ–≤–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–µ
            document.getElementById('deepThinkBtn').innerHTML = 'üß† Deep Think: OFF';
            document.getElementById('deepThinkBtn').classList.remove('active');
            
            document.getElementById('chatContainer').innerHTML = `
                <div class="chat-message assistant-message">
                    <strong>ü§ñ Assistant:</strong> Hello! I'm your movie recommendation assistant. Tell me what kind of movies you like, and I'll help you find something great to watch! You can mention genres, moods, favorite films, or anything else that comes to mind.<br><br>
                    <strong>üí° Pro Tip:</strong> Use the <em>"Deep Think"</em> mode for more detailed analysis and better recommendations!
                </div>
            `;
            document.getElementById('conversationId').textContent = 'Starting new conversation...';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function searchMovie() {
            const movieId = document.getElementById('movieId').value;
            const movieTitle = document.getElementById('movieTitle').value;

            hideAllSections();
            showLoading();
            clearDebug();

            try {
                let movie = null;

                if (movieId) {
                    debugLog(`Searching by ID: ${movieId}`);
                    movie = await fetchMovieById(movieId);
                } else if (movieTitle) {
                    debugLog(`Searching by title: ${movieTitle}`);
                    movie = await fetchMovieByTitle(movieTitle);
                } else {
                    showError('Please enter either a movie ID or title');
                    return;
                }

                if (movie) {
                    debugLog('Movie found:', movie);
                    displayMovie(movie);
                } else {
                    debugLog('No movie found');
                    showNoResults();
                }
            } catch (error) {
                console.error('Fetch error:', error);
                debugLog('Error:', error.message);
                showError('Failed to fetch movie data: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function fetchMovieById(id) {
            debugLog(`Trying to fetch movie by ID from: ${currentApiBase}/movies/${id}`);

            for (const baseUrl of API_BASE_URLS) {
                try {
                    debugLog(`Trying URL: ${baseUrl}/movies/${id}`);
                    const response = await fetch(`${baseUrl}/movies/${id}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        }
                    });

                    debugLog(`Response status: ${response.status}`);

                    if (response.ok) {
                        currentApiBase = baseUrl;
                        debugLog(`‚úÖ Success! Using base URL: ${baseUrl}`);
                        const movie = await response.json();
                        return movie;
                    } else if (response.status === 404) {
                        return null;
                    }
                } catch (error) {
                    debugLog(`Failed with ${baseUrl}: ${error.message}`);
                    continue;
                }
            }

            throw new Error('All API endpoints failed');
        }

        async function fetchMovieByTitle(title) {
            debugLog(`Trying to fetch movie by title: "${title}"`);

            for (const baseUrl of API_BASE_URLS) {
                try {
                    const url = `${baseUrl}/movies/title/${encodeURIComponent(title)}`;
                    debugLog(`Trying URL: ${url}`);

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        }
                    });

                    debugLog(`Response status: ${response.status}`);

                    if (response.ok) {
                        currentApiBase = baseUrl;
                        debugLog(`‚úÖ Success! Using base URL: ${baseUrl}`);
                        const movie = await response.json();
                        return movie;
                    } else if (response.status === 404) {
                        return null;
                    }
                } catch (error) {
                    debugLog(`Failed with ${baseUrl}: ${error.message}`);
                    continue;
                }
            }

            throw new Error('All API endpoints failed');
        }

        function displayMovie(movie) {
            const movieResult = document.getElementById('movieResult');

            const movieCard = `
                <div class="movie-card">
                    <div class="movie-header">
                        <div style="flex: 1;">
                            <h2 class="movie-title">${escapeHtml(movie.title || 'Unknown Title')}</h2>
                            ${movie.overview ? `
                                <div class="overview-section">
                                    <div class="movie-overview">
                                        <strong>Overview:</strong> ${escapeHtml(movie.overview)}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="movie-details">
                        ${movie.releaseDate ? `
                            <div class="detail-item">
                                <div class="detail-label">Release Date</div>
                                <div class="detail-value">${formatDate(movie.releaseDate)}</div>
                            </div>
                        ` : ''}
                        
                        ${movie.genres ? `
                            <div class="detail-item">
                                <div class="detail-label">Genres</div>
                                <div class="detail-value">${escapeHtml(movie.genres)}</div>
                            </div>
                        ` : ''}
                        
                        ${movie.runtime ? `
                            <div class="detail-item">
                                <div class="detail-label">Runtime</div>
                                <div class="detail-value">${movie.runtime} minutes</div>
                            </div>
                        ` : ''}
                        
                        ${movie.voteAverage ? `
                            <div class="detail-item">
                                <div class="detail-label">Rating</div>
                                <div class="detail-value">${movie.voteAverage}/10</div>
                            </div>
                        ` : ''}
                        
                        ${movie.originalLanguage ? `
                            <div class="detail-item">
                                <div class="detail-label">Original Language</div>
                                <div class="detail-value">${movie.originalLanguage}</div>
                            </div>
                        ` : ''}
                        
                        ${movie.budget ? `
                            <div class="detail-item">
                                <div class="detail-label">Budget</div>
                                <div class="detail-value">$${movie.budget.toLocaleString()}</div>
                            </div>
                        ` : ''}
                        
                        ${movie.revenue ? `
                            <div class="detail-item">
                                <div class="detail-label">Revenue</div>
                                <div class="detail-value">$${movie.revenue.toLocaleString()}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    ${movie.id ? `
                        <div style="margin-top: 20px; color: #b8b8b8; font-size: 0.9rem;">
                            Movie ID: ${movie.id}
                        </div>
                    ` : ''}
                </div>
            `;

            movieResult.innerHTML = movieCard;
            movieResult.classList.remove('hidden');
        }

        async function getRecommendationsByDescription() {
            const description = document.getElementById('description').value;
            const topK = document.getElementById('topK').value;
            const model = document.getElementById('embeddingModel').value;
            const distanceMetric = document.getElementById('distanceMetric').value;

            if (!description) {
                showError('Please enter a movie description');
                return;
            }

            hideAllSections();
            showLoading();
            clearDebug();

            try {
                debugLog(`Getting recommendations for: "${description}"`);
                debugLog(`Using model: ${model}, distance metric: ${distanceMetric}`);

                const response = await fetch(`${currentApiBase}/recommendations/similar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        Description: description,
                        TopK: parseInt(topK),
                        Model: model,
                        DistanceMetric: distanceMetric
                    })
                });

                debugLog(`Response status: ${response.status}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const recommendations = await response.json();
                debugLog(`Received ${recommendations.length} recommendations`);
                displayRecommendations(recommendations, `Recommendations for: "${description}"`);
            } catch (error) {
                console.error('Recommendation error:', error);
                debugLog('Error:', error.message);
                showError('Failed to get recommendations: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function getRecommendationsByTitle() {
            const movieTitle = document.getElementById('recommendationMovieTitle').value;
            const topK = document.getElementById('topKTitle').value;
            const model = document.getElementById('embeddingModel').value;
            const distanceMetric = document.getElementById('distanceMetric').value;

            if (!movieTitle) {
                showError('Please enter a movie title');
                return;
            }

            hideAllSections();
            showLoading();
            clearDebug();

            try {
                debugLog(`Getting similar movies for: "${movieTitle}"`);
                debugLog(`Using model: ${model}, distance metric: ${distanceMetric}`);

                const response = await fetch(`${currentApiBase}/recommendations/similar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        MovieTitle: movieTitle,
                        TopK: parseInt(topK),
                        Model: model,
                        DistanceMetric: distanceMetric
                    })
                });

                debugLog(`Response status: ${response.status}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const recommendations = await response.json();
                debugLog(`Received ${recommendations.length} recommendations`);
                displayRecommendations(recommendations, `Movies similar to: "${movieTitle}"`);
            } catch (error) {
                console.error('Recommendation error:', error);
                debugLog('Error:', error.message);
                showError('Failed to get recommendations: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        function displayRecommendations(recommendations, title) {
            const recommendationsList = document.getElementById('recommendationsList');
            const recommendationsResult = document.getElementById('recommendationsResult');

            if (!recommendations || recommendations.length === 0) {
                recommendationsList.innerHTML = '<div class="error">No recommendations found</div>';
                recommendationsResult.classList.remove('hidden');
                return;
            }

            const model = document.getElementById('embeddingModel').value;
            const distanceMetric = document.getElementById('distanceMetric').value;

            let html = `<h3 style="color: #feca57; margin-bottom: 20px;">${title}</h3>`;
            html += `<div style="color: #b8b8b8; margin-bottom: 15px; font-size: 0.9rem;">
                        Model: ${model} | Distance: ${distanceMetric}
                     </div>`;

            recommendations.forEach(rec => {
                const similarityScore = rec.similarityScore ?
                    `<span class="similarity-score">${(rec.similarityScore * 100).toFixed(1)}% match</span>` : '';

                html += `
                    <div class="recommendation-card">
                        <div class="recommendation-header">
                            <h3 class="recommendation-title">${escapeHtml(rec.movie.title || 'Unknown Title')}</h3>
                            ${similarityScore}
                        </div>
                        ${rec.movie.overview ? `
                            <div class="recommendation-overview">${escapeHtml(rec.movie.overview)}</div>
                        ` : ''}
                        <div class="recommendation-details">
                            ${rec.movie.genres ? `<span>üé≠ ${escapeHtml(rec.movie.genres)}</span>` : ''}
                            ${rec.movie.releaseDate ? `<span>üìÖ ${new Date(rec.movie.releaseDate).getFullYear()}</span>` : ''}
                            ${rec.movie.voteAverage ? `<span>‚≠ê ${rec.movie.voteAverage}/10</span>` : ''}
                            ${rec.movie.runtime ? `<span>‚è±Ô∏è ${rec.movie.runtime}min</span>` : ''}
                        </div>
                    </div>
                `;
            });

            recommendationsList.innerHTML = html;
            recommendationsResult.classList.remove('hidden');
        }

        function hideAllSections() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('movieResult').classList.add('hidden');
            document.getElementById('noResults').classList.add('hidden');
            document.getElementById('recommendationsResult').classList.add('hidden');
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.remove('hidden');
        }

        function showNoResults() {
            document.getElementById('noResults').classList.remove('hidden');
        }

        function debugLog(...args) {
            console.log(...args);
            const debugContent = document.getElementById('debugContent');
            const debugInfo = document.getElementById('debugInfo');

            debugContent.textContent += args.map(arg =>
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ') + '\n';

            debugInfo.classList.remove('hidden');
        }

        function clearDebug() {
            document.getElementById('debugContent').textContent = '';
            document.getElementById('debugInfo').classList.add('hidden');
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch {
                return dateString;
            }
        }

        // Event listeners
        document.getElementById('userMessage').addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('movieId').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') searchMovie();
        });

        document.getElementById('movieTitle').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') searchMovie();
        });

        document.getElementById('description').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') getRecommendationsByDescription();
        });

        document.getElementById('recommendationMovieTitle').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') getRecommendationsByTitle();
        });

        // Clear fields logic
        document.getElementById('movieId').addEventListener('input', function () {
            if (this.value) {
                document.getElementById('movieTitle').value = '';
            }
        });

        document.getElementById('movieTitle').addEventListener('input', function () {
            if (this.value) {
                document.getElementById('movieId').value = '';
            }
        });

        // Auto-detect API on load
        window.addEventListener('load', function () {
            debugLog('Page loaded. Testing API endpoints...');
			 createNewConversation();
        });
    </script>
</body>

</html>